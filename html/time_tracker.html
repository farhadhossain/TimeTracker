<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Current Contracts</title>
    <script>
       var user = JSON.parse(localStorage.getItem('user'));
       var $ = require('jquery');
       window.$ = $;
       jQuery= $;
       require('bootstrap');
    </script>
    <script src="../js/jquery.tmpl.min.js"></script>
     <script src="../js/stopwatch.js"></script>
    <link rel="stylesheet" href="../node_modules/bootstrap/dist/css/bootstrap.min.css">
    <style type="text/css">
      .counter{
        width: 100%;
        text-align: center;
        margin: 20px 0;
        color:#848484;
      }

      .tbl tr:first-child td {
        vertical-align: bottom;
        font-size: 80px;
      }

      .tbl td{
         text-align: center;
         vertical-align: top;
         font-size: 14px;
      }
    </style>
  </head>
  <body style="margin:0;padding:0;">
    <div id="container" style="width:100%;"> 

       <div class="panel panel-default" style="border:none;">

          <div class="panel-heading">
              <table width="100%"><tr>
                  <td>
                    <div class="dropdown">
                      <span type="button" id="dropdownMenu2" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                          User Name
                          <span class="caret"></span>
                      </span>
                      <!--ul class="dropdown-menu" aria-labelledby="dropdownMenu2" style="border:none;"> 
                        <li><a href="#">Settings...</a></li>
                        <li><a href="#">Support & Feedback...</a></li>
                        <li><a href="#">About...</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">Quit</a></li>
                      </ul-->
                    </div>
                  </td>
                  <td>
                      <div class="dropdown">
                          <span type="button" id="dropdownMenu2" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                             <h4 style="float:right;" class="glyphicon glyphicon-align-justify"></h4>
                          </span>
                          <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenu2" style="border:none;margin-top:40px;"> 
                            <li><a href="#">Settings</a></li>
                            <li role="separator" class="divider"></li>
                            <li><a href="#">About</a></li>
                            <li role="separator" class="divider"></li>
                            <li><a href="#">Log Out</a></li>
                          </ul>
                      </div>
                  </td>
              </tr></table>
          </div>


          <div class="list-group"> 
            <div class="list-group-item"><h4> Select Contract</h4></div>
          </div>

          <div class="counter">
              <center>
              <table class="tbl">
                <tr><td id="sw_h">00</td><td>:</td><td id="sw_m">00</td><td>:</td><td id="sw_s">00</td></tr>
                <tr><td>HOUR</td><td>&nbsp;</td><td>MIN</td><td>&nbsp;</td><td>SEC</td></tr>
              </table>
              </center>
          </div>

          <input type="button" class="btn btn-large btn-info btn-edit-trigger" style="width:90%;height:60px;margin-top:30px;margin-left:5%;" value="Start" id="sw_start" />
       
       </div>
      
    </div>

    <div class="modal fade" id="myPleaseWait" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="static">
        <div class="modal-dialog modal-sm" style="margin-top: 25%;width:50%;margin-left:25%;">
            <div class="modal-content">
                <div class="modal-header">
                    <span class="glyphicon glyphicon-time"></span>  Please Wait
                </div>
                <div class="modal-body">
                    <div class="progress">
                        <div class="progress-bar progress-bar-info progress-bar-striped active" style="width: 100%"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

  </body>

  <script id="list-group-item" type="text/x-custom-template">
    <a href="#" class="list-group-item"> 
        <table style="width:100%;height:100%;min-height:80px;"><tr> 
          <td style="width:94%">
            <h4 class="list-group-item-heading" style="color:#15B0E0;">${job_name}</h4> 
            <p class="list-group-item-text">${description}</p>
          </td>
          <td style="width:6%;height:100%;color:#9FE26E;font-size:30px;" valign="middle"><span class="glyphicon glyphicon-menu-right" style="float:right:"></span></td>
        </tr></table>
    </a> 
  </script>

  <script type="text/javascript">
      $('#container').css('height', $(window).height());
    
      function loadContract(){
            
            $('#myPleaseWait').modal('show');
            var url=' http://ec2-54-218-59-115.us-west-2.compute.amazonaws.com/api'; 
            var posting = $.ajax({
                          type:'POST', 
                          url:url,
                          dataType: "json",
                          contentType: "application/json",
                          headers: {"Content-Type": "application/json", 
                                    "Client-Service":"frontend-client",
                                    "Auth-Key":"3c6e0b8a9c15224a8228b9a98ca1531d", 
                                    "Authorization":user.token,
                                    "User-ID":user.id}, 
                          data:JSON.stringify({ action:"open_jobs"}) 
                        });

            posting.done(function( data ) {
               $('#myPleaseWait').modal('hide');

               var listItem = $('#list-group-item'); 
    
               $( data.data).each(function( index, val ) {
                  listItem.tmpl(val).appendTo(".list-group");
               });

               data =  JSON.parse(data);
            
            });

            posting.fail(function() {
               $('#myPleaseWait').modal('hide');
               alert("Couldn't connect to server");
             });
      }; 
      //loadContract();
      $('#reload').click(function(){
        loadContract();
      }); 
  </script>
  </html>